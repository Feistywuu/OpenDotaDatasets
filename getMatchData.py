import opendota
import requests
import json
import csv

# list of matches from ti22GroupStage
matches = [6806047119,
            6806047539,
            6806047576,
            6806047579,
            6806047605,
            6806094304,
            6806097565,
            6806097974,
            6806101302,
            6806112746,
            6806133891,
            6806142086,
            6806146943,
            6806155276,
            6806158709,
            6806174698,
            6806191928,
            6806203596,
            6806205877,
            6806227577,
            6806228770,
            6806244566,
            6806278486,
            6806282012,
            6806282981,
            6806291706,
            6806322784,
            6806364123,
            6806365638,
            6806374409,
            6806377510,
            6806403033,
            6806442183,
            6806454246,
            6806464370,
            6806472970,
            6806481932,
            6806534528,
            6806547123,
            6806547565,
            6806554071,
            6806566779,
            6806632563,
            6806638898,
            6806648571,
            6806662696,
            6806663153,
            6806751717,
            6806767627,
            6806790160,
            6807714693,
            6807716914,
            6807718331,
            6807721747,
            6807722622,
            6807758884,
            6807768064,
            6807772726,
            6807772753,
            6807776673,
            6807805121,
            6807818563,
            6807826416,
            6807826682,
            6807837834,
            6807880611,
            6807886186,
            6807886590,
            6807892967,
            6807900926,
            6807935361,
            6807936112,
            6807938213,
            6807939991,
            6807946326,
            6808011785,
            6808012161,
            6808028757,
            6808030636,
            6808042242,
            6808093633,
            6808093837,
            6808106195,
            6808122743,
            6808134162,
            6808167860,
            6808178906,
            6808199906,
            6808212619,
            6808247109,
            6808255902,
            6808272936,
            6808292501,
            6808300252,
            6808330940,
            6808348917,
            6808373109,
            6808416013,
            6808433308,
            6808446343,
            6809417173,
            6809417360,
            6809417403,
            6809419010,
            6809420587,
            6809454703,
            6809455169,
            6809456477,
            6809462072,
            6809481249,
            6809483969,
            6809499025,
            6809501366,
            6809506315,
            6809522859,
            6809523804,
            6809539681,
            6809547720,
            6809556554,
            6809561963,
            6809576271,
            6809580040,
            6809585544,
            6809612544,
            6809621786,
            6809638522,
            6809656584,
            6809660879,
            6809665094,
            6809701946,
            6809719707,
            6809734353,
            6809741589,
            6809742301,
            6809743691,
            6809783372,
            6809802856,
            6809806814,
            6809812984,
            6809815986,
            6809858739,
            6809875296,
            6809888330,
            6809894646,
            6809895411,
            6809980949,
            6809991048,
            6810014272,
            6810103823,
            6810818538,
            6810821187,
            6810821982,
            6810822833,
            6810825713,
            6810862170,
            6810862193,
            6810862848,
            6810863490,
            6810872192,
            6810895741,
            6810903010,
            6810903428,
            6810903559,
            6810906509,
            6810932324,
            6810942576,
            6810944275,
            6810950150,
            6810950415,
            6810974000,
            6810984589,
            6810986033,
            6811000638,
            6811003963,
            6811014822,
            6811035333,
            6811040499,
            6811050928,
            6811058155,
            6811064974,
            6811140084,
            6811142966,
            6811221669 ]



# open the file in the write mode
f = open('''C://Users//Philip//PycharmProjects//OpendotaQueries//dotadata.csv''', 'w')

# create the csv writer
writer = csv.writer(f)

# create a header row
#/match id, duration, team1: [hero1-5], team2:[hero1-5],
header = ['match_id', 'duration', 'radiant', 'dire']


with open('countries.csv', 'w', encoding='UTF8') as f:

    # write header
    writer.writerow(header)

    #iterate through matches
    for i in range(len(matches)):
        radiant = []
        dire = []

        # iterate through matches
        matchInfo = requests.get('https://api.opendota.com/api/matches/'+str(matches[i])+'?api_key=f22a1bb9-30a3-4486-8e90-c32c192b8dfe').json()
        #matchInfo = json.loads(matchInfo)

        print(matchInfo["picks_bans"])

        # iterate to gather all heroes picked in match
        for h in range(len(matchInfo["picks_bans"])):

            # if hero is picked
            if matchInfo["picks_bans"][h]['is_pick']:

                # if on radiant/dire, append to respective team
                if matchInfo["picks_bans"][h]['team'] == 0:
                    radiant.append(matchInfo["picks_bans"][h]['hero_id'])

                if matchInfo["picks_bans"][h]['team'] == 1:
                    dire.append(matchInfo["picks_bans"][h]['hero_id'])

            else:
                pass

        # get duration
        duration = matchInfo["duration"]

        # write a row to the csv file
        print([matches[i], duration, radiant, dire])
        writer.writerow([matches[i], duration, radiant, dire])




